(function($){$(document).on("click",".acbwm-get-template",function(event){var uri=$(this).data("uri");$.get(uri,function(data,status){$("#email_body").val(data);var myFrame=$("iframe").contents().find("body");myFrame.html(data)})});$(document).on("click","#acbwm_email_template_send_mail",function(event){event.preventDefault();var email=$("#acbwm_email_template_email").val();$(this).attr("disabled",true);if(validate_email(email)){var data={action:acbwm_admin.prefix+"send_test_email",email:email,template:$("#email_body").val(),heading:$("#heading").val(),use_woocommerce_style:$("[name='use_woocommerce_style']:checked").val()};var response=request(data);alert(response.data)}else{alert(acbwm_admin.i18n.enter_valid_email)}$(this).attr("disabled",false);return false});$(document).on("click","#acbwm_view_template_preview",function(event){var holder=$("#acbwm_preview_holder");holder.html(acbwm_admin.i18n.please_wait);var data={action:acbwm_admin.prefix+"view_email_preview",template:$("#email_body").val(),heading:$("#heading").val(),use_woocommerce_style:$("[name='use_woocommerce_style']:checked").val()};var response=request(data);holder.html(response.data)});$(document).on("change","[name='use_woocommerce_style']",function(event){var use_woocommerce_style=$(this).val();var heading=$("#acbwm_woo_email_heading");if(parseInt(use_woocommerce_style)===1){heading.removeClass("hidden")}else{heading.addClass("hidden")}});$(document).on("submit","#acbwm_saving_email_template",function(event){event.preventDefault();var data=$(this).serialize();var submit_btn=$(this).find("#submit");$(this).find(".error-text").remove();submit_btn.attr("disabled",true);var response=request(data);if(response.data.edit_url){window.location.href=response.data.edit_url}if(response.success===false){submit_btn.attr("disabled",false);$("<div class='error-text mtb-10'>"+response.data+"</div>").insertBefore(submit_btn)}return false});$(document).on("submit","#acbwm_settings_form",function(event){event.preventDefault();var data=$(this).serialize();var submit_btn=$(this).find("#submit");submit_btn.attr("disabled",true);var res=request(data);alert(res.data);submit_btn.attr("disabled",false);return false});$(document).on("submit","#acbwm_sending_email_manually",function(event){event.preventDefault();var data=$(this).serialize();var submit_btn=$(this).find("#submit");submit_btn.attr("disabled",true);var response=request(data);alert(response.data);submit_btn.attr("disabled",false);return false});$(document).on("change",".acbwm-change-email-template-status",function(event){var status=0;var is_checkbox_checked=$(this).prop("checked");if(is_checkbox_checked===true){status=1}$(this).prop("checked",!is_checkbox_checked);var response=request({action:acbwm_admin.prefix+"change_email_template_status",email:$(this).data("email"),status:status});if(response.success){$(this).prop("checked",is_checkbox_checked)}});function validate_email(email){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase())}function request(data){var response={};$.ajax({type:"POST",url:acbwm_admin.ajax_url,data:data,success:function(response_data){response=response_data},dataType:"JSON",async:false});return response}$(document).on("click",".acbwm-delete-cart",function(e){e.preventDefault();var response=request({action:acbwm_admin.prefix+"delete_cart",cart:$(this).data("cart")});window.location.reload();return false});$(document).on("change",'[name="coupon[generate_unique_coupons]"]',function(e){var coupon_block=$("#acbwm-coupon-settings tr.custom-coupon");if($(this).val()==="1"){coupon_block.removeClass("hidden")}else{coupon_block.addClass("hidden")}});var time_out;$(document).on("keyup",'[name="coupon[selected_coupon]"]',function(){var input=$(this);var term=input.val();if(term.length>=3){clearTimeout(time_out);time_out=setTimeout(function(){var response=request({coupon:term,action:acbwm_admin.prefix+"search_coupons",security:acbwm_admin.security.search_a_coupon});if(response.success){var lists=response.data,i,auto_complete_list;if(lists.length>0){var auto_complete_container=document.createElement("DIV");auto_complete_container.setAttribute("id",this.id+"-autocomplete-list");auto_complete_container.setAttribute("class","autocomplete-items");input.parent().append(auto_complete_container);for(i=0;i<lists.length;i++){var label=lists[i].text;var value=lists[i].id;auto_complete_list=document.createElement("DIV");auto_complete_list.innerHTML="<strong>"+label.substr(0,term.length)+"</strong>";auto_complete_list.innerHTML+=label.substr(term.length);auto_complete_list.setAttribute("data-value",value);auto_complete_list.addEventListener("click",function(e){input.val(this.getAttribute("data-value"));auto_complete_container.remove()});auto_complete_container.appendChild(auto_complete_list)}}}},1e3)}})})(jQuery);